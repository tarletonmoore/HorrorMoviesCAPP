@model IEnumerable<MyHorrorMovieApp.Models.Movie>

<!DOCTYPE html>
<html>

<head>
    <title>Movies Index</title>
    <!-- Your head content here -->
</head>

<body>
    <!-- Navigation bar or logout link -->
    <nav>
        <ul>
            <li><a href="/">Home</a></li>
            <form method="post" action="/logout">
                <button type="submit">Logout</button>
            </form>

        </ul>
    </nav>

    <h1>Movies Index</h1>
    <!-- Display each movie and its details -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            // Define the submitReview function in the global scope
            window.submitReview = function (movieId) {
                var formData = $('#reviewForm_' + movieId).serialize();
                console.log(formData);
                $.ajax({
                    url: '/Review/Create',
                    type: 'POST',
                    data: formData,
                    success: function (data) {
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        // Optionally handle error here
                    }
                });
            };
        });
    </script>
    @foreach (var movie in Model)
    {
        <div class="movie-card">
            <h2>@movie.Title</h2>
            <img src="@movie.Image" alt="@movie.Title" width="300px" />
            <h3>Reviews</h3>
            <ul>
                @foreach (var review in movie.Reviews)
                {
                    <li>@review.User.Username: @review.Comment</li>
                }
            </ul>

            <form method="post" action="/Review/Create">
                <input type="hidden" id="MovieId" name="MovieId" value="@movie.Id" />
                <input type="text" id="Comment" name="Comment" />
                <button type="submit">Add Review</button>
            </form>
        </div>
        @* <form id="reviewForm_@movie.Id">
    <input type="hidden" name="MovieId" value="@movie.Id" />
    <input type="text" name="Comment" />
    <button type="button" onclick="submitReview(@movie.Id)">Add Review</button>
    </form> *@
        @* </div> *@
    }


    }


</body>

</html>
